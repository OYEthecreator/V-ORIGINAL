<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MINIMALISM - Architectural Product Experience</title>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script>
    // Initialize theme immediately to prevent flash
    (function () {
      const savedTheme = localStorage.getItem('theme');
      const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

      // Set initial theme: saved preference > system preference > light
      const initialTheme = savedTheme || (systemPrefersDark ? 'dark' : 'light');
      document.documentElement.setAttribute('data-theme', initialTheme);
    })();
  </script>
  <style>
    :root {
      --pure-white: #ffffff;
      --gallery-white: #f8f9fa;
      --architect-black: #000000;
      --concrete-gray: #e9ecef;
      --fog: #D1D1D1;
      --precision-line: rgba(0, 0, 0, 0.1);
      --dark-gray: #333333;
      --medium-gray: #666666;
      --light-gray: #cccccc;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: var(--fog);
      color: var(--architect-black);
      font-family: 'Inter', sans-serif;
      overflow-x: hidden;
    }

    /* ARCHITECTURAL GRID BACKGROUND */
    .architectural-grid {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background:
        linear-gradient(90deg, var(--precision-line) 1px, transparent 1px),
        linear-gradient(180deg, var(--precision-line) 1px, transparent 1px);
      background-size: 50px 50px;
      z-index: -3;
      animation: gridShift 20s linear infinite;
    }

    @keyframes gridShift {
      0% {
        transform: translate(0, 0);
      }

      100% {
        transform: translate(50px, 50px);
      }
    }

    /* FLOATING GEOMETRY */
    .floating-geometry {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -2;
    }

    .geometry-piece {
      position: absolute;
      border: 2px solid var(--precision-line);
      animation: geometryFloat 8s ease-in-out infinite;
    }

    @keyframes geometryFloat {

      0%,
      100% {
        transform: translateY(0) rotate(0deg);
      }

      33% {
        transform: translateY(-30px) rotate(90deg);
      }

      66% {
        transform: translateY(15px) rotate(180deg);
      }
    }

    /* SURGICAL NAVIGATION */
    .surgical-nav {
      position: fixed;
      top: 0;
      width: 100%;
      padding: 10px 40px;
      display: flex;
      justify-content: space-around;
      align-items: center;
      background: transparent;
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--precision-line);
      z-index: 1000;
    }

    .nav-brand {
      display: flex;
      align-items: center;
    }

    .nav-links {
      display: flex;
      gap: 40px;
    }

    .nav-links a {
      color: var(--architect-black);
      text-decoration: none;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 3px;
      font-size: 11px;
      position: relative;
      transition: all 0.3s ease;
    }

    .nav-links a::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 0;
      height: 2px;
      background: var(--architect-black);
      transition: width 0.3s ease;
    }

    .nav-links a:hover::after {
      width: 100%;
    }

    /* MONOCHROME FLOATING CART */
    .time-capsule-cart {
      position: fixed;
      top: 2rem;
      right: 2rem;
      width: 60px;
      height: 60px;
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid var(--architect-black);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1001;
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      backdrop-filter: blur(20px);
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
    }

    .time-capsule-cart:hover {
      transform: scale(1.1);
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.2);
    }

    .cart-icon-monochrome {
      font-size: 1.4rem;
      color: var(--architect-black);
    }

    .cart-count-monochrome {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--architect-black);
      color: var(--pure-white);
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 700;
      border: 2px solid var(--pure-white);
    }

    /* PRODUCT SCULPTURE */
    .product-sculpture {
      position: sticky;
      top: 120px;
      background: var(--gallery-white);
      border-radius: 20px;
      border: 1px solid var(--precision-line);
      overflow: hidden;
      transition: all 0.5s ease;
    }

    .product-sculpture:hover {
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
    }

    /* ARCHITECTURAL LAYOUT */
    .architectural-display {
      min-height: 100vh;
      padding: 120px 40px 60px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 60px;
      align-items: start;
      max-width: 1400px;
      margin: 0 auto;
    }

    .product-gallery {
      position: sticky;
      top: 120px;
    }

    /* THUMBNAIL GALLERY */
    .thumbnail-strip {
      display: flex;
      gap: 15px;
      margin-top: 20px;
      padding: 10px;
      overflow-x: auto;
      scroll-behavior: smooth;
    }

    .thumbnail-strip::-webkit-scrollbar {
      height: 4px;
    }

    .thumbnail-strip::-webkit-scrollbar-track {
      background: var(--gallery-white);
    }

    .thumbnail-strip::-webkit-scrollbar-thumb {
      background: var(--architect-black);
      border-radius: 10px;
    }

    .thumbnail {
      flex: 0 0 80px;
      height: 80px;
      border-radius: 4px;
      border: 1px solid var(--precision-line);
      background: var(--gallery-white);
      cursor: pointer;
      overflow: hidden;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .thumbnail:hover {
      border-color: var(--architect-black);
      transform: translateY(-2px);
    }

    .thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0.6;
      transition: opacity 0.3s ease;
    }

    .thumbnail:hover img {
      opacity: 1;
    }

    .sculpture-placeholder {
      width: 100%;
      height: 600px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--architect-black);
      font-size: 1.1rem;
      position: relative;
    }

    .sculpture-placeholder::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 0, 0, 0.02), transparent);
      animation: surgicalShine 4s ease-in-out infinite;
    }

    @keyframes surgicalShine {
      0% {
        left: -100%;
      }

      100% {
        left: 100%;
      }
    }

    /* CART DRAWER */
    .cart-drawer {
      position: fixed;
      top: 0;
      right: -400px;
      width: 380px;
      height: 100%;
      background: var(--gallery-white);
      border-left: 1px solid var(--precision-line);
      box-shadow: -5px 0 30px rgba(0, 0, 0, 0.05);
      padding: 30px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: right 0.5s ease;
      z-index: 2000;
    }

    .cart-drawer.active {
      right: 0;
    }

    .cart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--precision-line);
      padding-bottom: 15px;
      margin-bottom: 20px;
    }

    .cart-header h2 {
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: var(--architect-black);
    }

    .cart-close {
      cursor: pointer;
      font-size: 1.2rem;
      color: var(--architect-black);
    }

    .cart-items {
      flex: 1;
      overflow-y: auto;
      padding: 10px 0;
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      border-bottom: 1px solid var(--precision-line);
      padding-bottom: 10px;
    }

    .item-title {
      font-weight: 600;
      margin-bottom: 5px;
      color: var(--architect-black);
    }

    .item-meta {
      font-size: 0.85rem;
      color: var(--medium-gray);
    }

    .item-price {
      font-weight: 500;
      color: var(--architect-black);
    }

    .cart-footer {
      border-top: 1px solid var(--precision-line);
      padding-top: 15px;
    }

    .cart-total {
      margin-bottom: 15px;
      font-weight: 600;
      color: var(--architect-black);
    }

    .checkout-btn {
      width: 100%;
      padding: 15px;
      border: 1px solid var(--architect-black);
      border-radius: 25px;
      background: var(--architect-black);
      color: var(--pure-white);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 2px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .checkout-btn:hover {
      background: transparent;
      color: var(--architect-black);
    }

    /* PRECISION INFO */
    .precision-info {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      border: 1px solid var(--precision-line);
      padding: 50px;
      position: relative;
      overflow: hidden;
    }

    .precision-info::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: var(--architect-black);
      animation: lineExtend 2s ease-out;
    }

    @keyframes lineExtend {
      0% {
        width: 0;
      }

      100% {
        width: 100%;
      }
    }

    .product-title {
      font-size: 3rem;
      font-weight: 300;
      margin-bottom: 10px;
      letter-spacing: -1px;
      color: var(--architect-black);
    }

    .product-price {
      font-size: 1.8rem;
      font-weight: 400;
      margin-bottom: 30px;
      color: var(--architect-black);
    }

    .product-description {
      font-size: 1.1rem;
      line-height: 1.7;
      margin-bottom: 40px;
      color: var(--medium-gray);
    }

    /* ARCHITECTURAL FEATURES */
    .architectural-features {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin: 40px 0;
    }

    .feature-pillar {
      background: var(--pure-white);
      padding: 25px;
      border: 1px solid var(--precision-line);
      border-radius: 15px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
      color: var(--architect-black);
    }

    .feature-pillar:hover {
      transform: translateY(-5px);
      border-color: var(--architect-black);
    }

    .pillar-icon {
      font-size: 2rem;
      margin-bottom: 15px;
    }

    /* PRECISION CONTROLS */
    .precision-controls {
      margin: 40px 0;
    }

    .control-options {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .control-option {
      padding: 12px 24px;
      border: 1px solid var(--precision-line);
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: transparent;
      color: var(--medium-gray);
    }

    .control-option:hover {
      border-color: var(--architect-black);
      color: var(--architect-black);
    }

    .control-option.selected {
      background: var(--architect-black);
      color: var(--pure-white);
      border-color: var(--architect-black);
    }

    /* SURGICAL ACTIONS */
    .surgical-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin: 40px 0;
    }

    .surgical-btn {
      padding: 18px 30px;
      border: 1px solid var(--architect-black);
      border-radius: 25px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 2px;
      font-size: 12px;
    }

    .surgical-btn.primary {
      background: var(--architect-black);
      color: var(--pure-white);
    }

    .surgical-btn.primary:hover {
      background: transparent;
      color: var(--architect-black);
    }

    .surgical-btn.secondary {
      background: transparent;
      color: var(--architect-black);
    }

    .surgical-btn.secondary:hover {
      background: var(--architect-black);
      color: var(--pure-white);
    }

    /* FLOATING PRECISION */
    .floating-precision {
      position: fixed;
      bottom: 30px;
      right: 30px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      z-index: 1000;
    }

    .precision-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--pure-white);
      border: 1px solid var(--precision-line);
      color: var(--architect-black);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.2rem;
    }

    .precision-btn:hover {
      background: var(--architect-black);
      color: var(--pure-white);
      transform: scale(1.1);
    }

    .badge {
      position: absolute;
      top: 10px;
      left: 10px;
      background: var(--dark-gray);
      color: var(--pure-white);
      font-weight: bold;
      font-size: 0.85rem;
      padding: 5px 10px;
      border-radius: 4px;
      z-index: 5;
    }

    .badge.limited-edition {
      background: var(--medium-gray);
      left: auto;
      right: 10px;
    }

    /* Stock & Quantity */
    .stock-info {
      font-size: 0.95rem;
      color: var(--dark-gray);
      margin: 10px 0;
    }

    .quantity-selector {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }

    .quantity-selector button {
      width: 30px;
      height: 30px;
      border: 1px solid var(--light-gray);
      background: var(--gallery-white);
      cursor: pointer;
      font-size: 1rem;
      color: var(--architect-black);
    }

    .quantity-selector input {
      width: 50px;
      text-align: center;
      margin: 0 5px;
      border: 1px solid var(--light-gray);
      padding: 5px;
      font-size: 1rem;
      color: var(--architect-black);
      background: var(--pure-white);
    }

    /* Product Variants */
    .product-variants h3 {
      margin-top: 15px;
      margin-bottom: 5px;
      font-weight: 600;
      color: var(--architect-black);
    }

    .color-options,
    .material-options {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }

    .color-option {
      width: 25px;
      height: 25px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid var(--light-gray);
      transition: transform 0.2s, border 0.2s;
    }

    .color-option:hover {
      transform: scale(1.1);
      border-color: var(--architect-black);
    }

    .material-option {
      padding: 5px 10px;
      border: 1px solid var(--light-gray);
      cursor: pointer;
      border-radius: 4px;
      transition: background 0.2s;
      color: var(--architect-black);
      background: var(--pure-white);
    }

    .material-option:hover {
      background: var(--gallery-white);
    }

    /* POPUP STYLES */
    .popup-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 9999;
      justify-content: center;
      align-items: center;
    }

    .popup-content {
      background: var(--pure-white);
      border: 1px solid var(--precision-line);
      border-radius: 8px;
      padding: 30px;
      width: 90%;
      max-width: 400px;
      position: relative;
      color: var(--architect-black);
    }

    .popup-content h2 {
      color: var(--architect-black);
      border-bottom: 1px solid var(--precision-line);
      padding-bottom: 10px;
      margin-bottom: 20px;
    }

    .close-btn {
      color: var(--architect-black);
      font-size: 24px;
      transition: all 0.3s ease;
      position: absolute;
      top: 10px;
      right: 15px;
      cursor: pointer;
    }

    .close-btn:hover {
      color: var(--dark-gray);
    }

    .popup-content input,
    .popup-content select {
      background: var(--pure-white);
      border: 1px solid var(--precision-line);
      color: var(--architect-black);
      padding: 12px;
      border-radius: 4px;
      transition: all 0.3s ease;
      width: 100%;
      margin-bottom: 15px;
    }

    .popup-content input:focus,
    .popup-content select:focus {
      border-color: var(--dark-gray);
      outline: none;
    }

    .popup-content button {
      background: var(--architect-black);
      color: var(--pure-white);
      border: none;
      padding: 12px;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .popup-content button:hover {
      background: var(--dark-gray);
    }

    /* CART OVERLAY */
    #cart-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      z-index: 9999;
      overflow-y: auto;
      padding: 40px;
    }

    #close-cart {
      color: var(--pure-white);
      font-size: 2rem;
      cursor: pointer;
      position: absolute;
      top: 20px;
      right: 40px;
    }

    /* BUTTONS */
    #add-to-cart,
    #buy-now {
      background: var(--architect-black);
      color: var(--pure-white);
      border: 2px solid var(--architect-black);
      padding: 12px 30px;
      font-size: 14px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 5px;
    }

    #add-to-cart:hover,
    #buy-now:hover {
      background: transparent;
      color: var(--architect-black);
    }

    /* RESPONSIVE */
    @media (max-width: 968px) {
      .architectural-display {
        grid-template-columns: 1fr;
        gap: 40px;
        padding: 120px 20px 40px;
      }

      .surgical-nav {
        gap: 20px;
        padding: 12px 20px;
      }

      .architectural-features {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <!-- üîí FIXED GOLD LUXURY BACK BUTTON -->
  <style>
    .back-btn-fixed {
      position: fixed;
      top: 22px;
      left: 22px;
      z-index: 10000;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border: 1px solid #000000;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      padding: 10px 16px;
      border-radius: 4px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      color: #000000;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .back-btn-fixed:hover {
      background: #000000;
      color: #FFFFFF;
      transform: translateX(-3px);
    }

    .back-btn-fixed svg {
      width: 18px;
      height: 18px;
      stroke: currentColor;
      transition: transform 0.3s ease;
    }

    .back-btn-fixed:hover svg {
      transform: translateX(-2px);
    }

/* Fix for main image responsiveness */
.main-image {
    width: 100%;
    height: auto;
    min-height: 600px;
    border-radius: 0;
    border: none;
    background: transparent;
    overflow: hidden;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    position: relative;
    margin-bottom: 20px;
}

.main-image img {
    width: 100%;
    height: auto;
    max-height: 90vh;
    object-fit: contain;
    object-position: top;
    display: block;
}

/* Tablet (768px - 1024px) */
@media screen and (max-width: 1024px) {
    .architectural-display {
        gap: 40px;
        padding: 120px 30px 60px;
    }
    
    .main-image {
        min-height: 500px;
    }
    
    .main-image img {
        max-height: 80vh;
    }
    
    .product-title {
        font-size: 2.5rem;
    }
    
    .product-price {
        font-size: 1.6rem;
    }
    
    .product-description {
        font-size: 1rem;
    }
    
    .architectural-features {
        gap: 15px;
    }
    
    .feature-pillar {
        padding: 20px;
    }
    
    .surgical-actions {
        grid-template-columns: 1fr;
        gap: 12px;
    }
    
    .cart-drawer {
        width: 350px;
    }
}

/* Mobile (max-width: 767px) */
@media screen and (max-width: 767px) {
    .surgical-nav {
        padding: 15px 20px;
    }
    
    .architectural-display {
        grid-template-columns: 1fr;
        padding: 100px 20px 40px;
        gap: 30px;
    }
    
    .product-gallery {
        position: static;
    }
    
    .main-image {
        min-height: 400px;
        margin-bottom: 15px;
    }
    
    .main-image img {
        max-height: 70vh;
    }
    
    .thumbnail-strip {
        gap: 10px;
        padding: 5px;
    }
    
    .thumbnail {
        flex: 0 0 80px;
        height: 80px;
    }
    
    .precision-info {
        padding: 25px;
    }
    
    .product-title {
        font-size: 1.8rem;
    }
    
    .product-price {
        font-size: 1.4rem;
    }
    
    .product-description {
        font-size: 0.95rem;
    }
    
    .architectural-features {
        grid-template-columns: 1fr;
        gap: 12px;
    }
    
    .feature-pillar {
        padding: 15px;
        font-size: 0.9rem;
    }
    
    .pillar-icon {
        font-size: 1.5rem;
    }
    
    .control-options {
        gap: 8px;
    }
    
    .control-option {
        padding: 8px 16px;
        font-size: 0.85rem;
    }
    
    .quantity-selector {
        margin-bottom: 20px;
    }
    
    .surgical-btn {
        padding: 14px 20px;
        font-size: 11px;
    }
    
    .time-capsule-cart {
        top: 1.5rem;
        right: 1.5rem;
        width: 50px;
        height: 50px;
    }
    
    .cart-icon-monochrome {
        font-size: 1.2rem;
    }
    
    .cart-count-monochrome {
        width: 20px;
        height: 20px;
        font-size: 0.7rem;
    }
    
    .cart-drawer {
        width: 100%;
        right: -100%;
    }
    
    .cart-drawer.active {
        right: 0;
    }
    
    .floating-precision {
        bottom: 15px;
        right: 15px;
        gap: 10px;
    }
    
    .precision-btn {
        width: 45px;
        height: 45px;
        font-size: 1rem;
    }
    
    .popup-content {
        width: 95%;
        max-width: 95%;
        padding: 20px;
    }
}

/* Small Mobile (max-width: 480px) */
@media screen and (max-width: 480px) {
    .architectural-display {
        padding: 80px 15px 20px;
    }
    
    .main-image {
        min-height: 300px;
        margin-bottom: 10px;
    }
    
    .main-image img {
        max-height: 60vh;
    }
    
    .thumbnail {
        flex: 0 0 60px;
        height: 60px;
    }
    
    .precision-info {
        padding: 20px;
        border-radius: 12px;
    }
    
    .product-title {
        font-size: 1.6rem;
    }
    
    .product-price {
        font-size: 1.3rem;
    }
    
    .back-btn-fixed {
        top: 15px;
        left: 15px;
        padding: 8px 14px;
        font-size: 14px;
    }
    
    .popup-content {
        padding: 15px;
    }
    
    .popup-content h2 {
        font-size: 1.3rem;
    }
}

/* Large Desktop (min-width: 1400px) */
@media screen and (min-width: 1400px) {
    .main-image img {
        max-height: 850px;
    }
}

/* Prevent image distortion on very tall screens */
@media screen and (max-height: 800px) and (min-width: 768px) {
    .main-image {
        min-height: 70vh;
    }
    
    .main-image img {
        max-height: 70vh;
    }
}
    
  </style>

  <button class="back-btn-fixed" onclick="goBack()">
    <svg fill="none" viewBox="0 0 24 24" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
    </svg>
    Back
  </button>

  <script>
    function goBack() {
      if (document.referrer) {
        window.history.back();
      } else {
        window.location.href = "/"; // fallback home
      }
    }
  </script>

  <!-- Background -->
  <div class="architectural-grid"></div>
  <div class="floating-geometry" id="geometry"></div>

  <!-- MONOCHROME FLOATING CART -->
  <div class="time-capsule-cart" id="open-cart-floating">
    <i class="fa-solid fa-bag-shopping cart-icon-monochrome"></i>
    <span class="cart-count-monochrome" id="cart-count">0</span>
  </div>

  <!-- Architectural Display -->
  <div class="architectural-display">
    <div class="product-gallery">
      <!-- Product Sculpture - IMAGE FIXED HERE -->
      <div class="main-image" data-aos="flip-left" data-aos-duration="2000" data-aos-delay="600">
        <div class="image-placeholder" id="productImage">
          <!-- ONLY CHANGE: Add your actual image path here -->
          <img src="./images/your-product-image.jpg" alt="Essential Form Jacket" width="100%">
          <div
            style="position: absolute; bottom: 20px; left: 20px; background: rgba(71, 69, 69, 0.9); padding: 10px; border-radius: 8px; font-size: 12px; color: white;">
            Pure Form ‚Ä¢ Essential Design
          </div>
        </div>
      </div>
      <div class="thumbnail-strip">
        <div class="thumbnail"></div>
        <div class="thumbnail"></div>
        <div class="thumbnail"></div>
        <div class="thumbnail"></div>
        <div class="thumbnail"></div>
      </div>
    </div>
    <!-- Precision Information -->
    <div class="precision-info" data-aos="fade-left" data-aos-duration="1800" data-aos-delay="800">
      <h1 class="product-title" id="dynamic-title" data-aos="fade-up" data-aos-delay="900">Essential Form Jacket</h1>
      <div class="product-price" id="dynamic-price" data-aos="fade-up" data-aos-delay="1000">$420</div>
      <p class="product-description" id="dynamic-description" data-aos="fade-up" data-aos-delay="1100">
        Architectural precision meets essential form. Crafted from pure wool with surgical stitching.
        Every line serves a purpose, every seam defines structure. This is minimalism as an art form.
      </p>

      <!-- Architectural Features -->
      <div class="architectural-features" id="styleFeatures">
        <div class="feature-pillar" id="materialViewBtn" onclick="openFeature('molecular-view')" data-aos="zoom-in"
          data-aos-delay="1300">
          <div class="pillar-icon">üî¨</div>
          <div>Molecular View</div>
        </div>
        <div class="feature-pillar" id="sizeGuideBtn" onclick="openFeature('proportion-calc')" data-aos="zoom-in"
          data-aos-delay="1400">
          <div class="pillar-icon">üìê</div>
          <div>Proportion Calc</div>
        </div>
        <div class="feature-pillar" id="styleSuggestionBtn" onclick="openFeature('essential-pairings')"
          data-aos="zoom-in" data-aos-delay="1500">
          <div class="pillar-icon">‚ö°</div>
          <div>Essential Pairings</div>
        </div>
      </div>

      <!-- Buttons -->
      <div style="margin: 20px 0;">
        <button id="add-to-cart">Add to Cart</button>
        <button id="buy-now">Buy Now</button>
      </div>

      <!-- Precision Controls -->
      <div class="precision-controls" data-aos="fade-up" data-aos-delay="1600">
        <h3 style="margin-bottom: 20px; font-weight: 600;">Select Proportion</h3>
        <div class="control-options" id="sizeOptions">
          <div class="control-option" onclick="selectProportion(this)" data-aos="fade-up" data-aos-delay="1700">XS</div>
          <div class="control-option" onclick="selectProportion(this)" data-aos="fade-up" data-aos-delay="1800">S</div>
          <div class="control-option selected" onclick="selectProportion(this)" data-aos="fade-up"
            data-aos-delay="1900">M</div>
          <div class="control-option" onclick="selectProportion(this)" data-aos="fade-up" data-aos-delay="2000">L</div>
          <div class="control-option" onclick="selectProportion(this)" data-aos="fade-up" data-aos-delay="2100">XL</div>
        </div>
      </div>
      <!-- Extra Features -->
      <div class="product-extra-features">
        <!-- Stock & Quantity -->
        <div class="stock-info" id="stockInfo">In Stock: 12</div>
        <div class="quantity-selector" id="quantitySelector">
          <button onclick="decreaseQuantity()">-</button>
          <input type="number" value="1" min="1" max="12" id="quantityInput">
          <button onclick="increaseQuantity()">+</button>
        </div>

        <!-- Product Variants -->
        <div class="product-variants">
          <h3>Colors</h3>
          <div class="color-options" id="colorOptions">
            <div class="color-option" style="background: white;"></div>
            <div class="color-option" style="background: gray;"></div>
            <div class="color-option" style="background: black;"></div>
          </div>
          <h3>Materials</h3>
          <div class="material-options" id="materialOptions">
            <div class="material-option">Cotton</div>
            <div class="material-option">Leather</div>
            <div class="material-option">Mesh</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cart Drawer -->
  <div class="cart-drawer" id="cartSidebar">
    <div class="cart-header">
      <h2>Essentials Bag</h2>
      <span class="cart-close" id="closeCartBtn" onclick="toggleCart()">‚úï</span>
    </div>
    <div class="cart-items" id="cartItems">
      <div class="cart-item">
        <div class="item-info">
          <div class="item-title">Essential Form Jacket</div>
          <div class="item-meta">Size: M</div>
        </div>
        <div class="item-price">$420</div>
      </div>
    </div>
    <div class="cart-footer">
      <div class="cart-total" id="cartTotal">Total: $420</div>
      <button class="checkout-btn" id="checkoutBtn">Proceed to Checkout</button>
    </div>
  </div>

  <!-- Popup -->
  <div id="buy-popup" class="popup-overlay">
    <div class="popup-content">
      <span id="close-popup" class="close-btn">&times;</span>
      <h2>Checkout</h2>
      <input id="full-name" placeholder="Full Name">
      <input id="address" placeholder="Address">
      <input id="city" placeholder="City">
      <input id="phone" placeholder="Phone Number">
      <select id="shipping-method">
        <option value="standard">Standard ($0)</option>
        <option value="express">Express ($3,000)</option>
        <option value="premium">Premium ($5,000)</option>
      </select>
      <button onclick="confirmPurchase()">Confirm Purchase</button>
    </div>
  </div>

  <!-- Cart Overlay -->
  <div id="cart-overlay">
    <span id="close-cart">&times;</span>
    <h1 style="color: white; text-align: center; margin-bottom: 30px;">
      <img src="./images/monochrome official logo.png" width="80px" alt="">
    </h1>
    <div id="cart-items"></div>
    <div id="cart-total" style="color: white; text-align: right; font-size: 1.8rem; margin-top: 30px;"></div>
    <button id="buy-now"
      style="display: block; margin: 20px auto; padding: 15px 40px; font-size: 1.2rem; background: white; color: black; border: none; border-radius: 8px; cursor: pointer;">
      Buy all items
    </button>
  </div>

  <!-- Floating Precision -->
  <div class="floating-precision">
    <div class="precision-btn" onclick="shareitem()" data-aos="fade-left" data-aos-delay="2500">‚Üó</div>
    <div class="precision-btn" onclick="scrollToEssence()" data-aos="fade-left" data-aos-delay="2700">‚Üë</div>
  </div>

  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="product.js"></script>
  <script>
    function shareitem() {
      if (navigator.share) {
        navigator.share({
          title: 'VOUX.FASHION',
          text: 'Check out this clean piece from voux',
          url: window.location.href
        })
          .then(() => console.log('item shared successfully'))
          .catch((error) => console.log('error sharing:', error));
      } else {
        alert('sharing not supported')
      }
    };
    // Initialize theme on page load
    document.addEventListener('DOMContentLoaded', function () {
      const savedTheme = localStorage.getItem('theme');
      const htmlElement = document.documentElement;
      const body = document.body;
      const architecturalGrid = document.querySelector('.architectural-grid');

      if (savedTheme) {
        htmlElement.setAttribute('data-theme', savedTheme);

        if (savedTheme === 'dark') {
          // Apply dark theme styles
          body.style.background = '#000000';
          body.style.color = '#ffffff';
          document.documentElement.style.setProperty('--pure-white', '#000000');
          document.documentElement.style.setProperty('--gallery-white', '#1a1a1a');
          document.documentElement.style.setProperty('--architect-black', '#ffffff');
          document.documentElement.style.setProperty('--concrete-gray', '#2d2d2d');
          document.documentElement.style.setProperty('--fog', '#333333');
          document.documentElement.style.setProperty('--precision-line', 'rgba(255, 255, 255, 0.1)');

          if (architecturalGrid) {
            architecturalGrid.style.background =
              'linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px), ' +
              'linear-gradient(180deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px)';
          }
        }
      }
    });

    // Create floating geometry
    function createGeometry() {
      const container = document.getElementById('geometry');
      const shapes = ['50% 50%', '0% 50%', '50% 0%', '100% 50%', '50% 100%'];

      shapes.forEach((shape, index) => {
        const piece = document.createElement('div');
        piece.className = 'geometry-piece';
        piece.style.cssText = `
                    width: ${100 + index * 50}px;
                    height: ${100 + index * 50}px;
                    top: ${20 + index * 15}%;
                    left: ${10 + index * 10}%;
                    border-radius: ${shape};
                    animation-delay: ${index * 2}s;
                `;
        container.appendChild(piece);
      });
    }

    // Interactive functions
    function selectProportion(element) {
      document.querySelectorAll('.control-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      element.classList.add('selected');
    }

    function addToEssentials() {
      const btn = event.target;
      btn.innerHTML = '‚úì ESSENTIAL ADDED';
      btn.style.background = 'transparent';
      btn.style.color = 'var(--architect-black)';

      setTimeout(() => {
        btn.innerHTML = 'Add to Essentials';
        btn.style.background = '';
        btn.style.color = '';
      }, 2000);
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function () {
      createGeometry();
      AOS.init({
        duration: 1500,
        once: true,
        offset: 100,
        easing: 'ease-out-cubic'
      });
    });
    // toggle cart drawer
    function toggleCart() {
      document.getElementById("cartDrawer").classList.toggle("active");
    }

    // override "Add to Essentials" to open cart drawer
    function addToEssentials() {
      const btn = event.target;
      btn.innerHTML = '‚úì ADDED TO ESSENTIALS';
      setTimeout(() => { btn.innerHTML = 'Add to Essentials'; }, 2000);
      toggleCart();
    }


    // Placeholder functions
    function sharePerfection() { alert('Share this perfection'); }
    function toggleGrid() { document.querySelector('.architectural-grid').style.opacity = '0.5'; }
    function scrollToEssence() { window.scrollTo({ top: 0, behavior: 'smooth' }); }



    (function () {
      'use strict';

      // -----------------------
      // State from localStorage
      // -----------------------
      const cartCountEl = document.getElementById('cart-count');
      let cartCount = parseInt(localStorage.getItem('cartCount')) || 0;
      if (cartCountEl) cartCountEl.textContent = cartCount;

      // key: cartItems
      let cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];

      // -----------------------
      // Helper utilities
      // -----------------------
      function saveCartToStorage() {
        localStorage.setItem('cartItems', JSON.stringify(cartItems));
        localStorage.setItem('cartCount', cartItems.reduce((s, i) => s + (i.qty || 0), 0));
        cartCount = parseInt(localStorage.getItem('cartCount')) || 0;
        if (cartCountEl) cartCountEl.textContent = cartCount;
      }

      function parsePriceText(priceText) {
        // Accepts "‚Ç¶15,000", "$15,000.00", "15,000" etc -> returns number 15000
        if (!priceText) return 0;
        const numeric = String(priceText).replace(/[^\d.,-]/g, '');
        // Remove commas
        return parseFloat(numeric.replace(/,/g, '')) || 0;
      }

      function formatCurrency(amount, symbol = '‚Ç¶') {
        return symbol + Number(amount || 0).toLocaleString();
      }

      // -----------------------
      // ADD TO CART (unchanged behavior, preserved)
      // -----------------------
      const addToCartBtn = document.getElementById('add-to-cart');
      if (addToCartBtn) {
        addToCartBtn.addEventListener('click', () => {
          const name = document.getElementById('dynamic-title')?.textContent.trim() || 'Product';
          const priceText = document.getElementById('dynamic-price')?.textContent.trim() || '‚Ç¶0';
          const currencySymbol = priceText.match(/[^\d,.\s]/)?.[0] || '‚Ç¶';
          const price = parsePriceText(priceText);

          const image = document.querySelector('.main-image img')?.src || 'https://via.placeholder.com/80';
          const quantity = parseInt(document.getElementById('quantity-input')?.value) || 1;
          const size = document.querySelector('.size-option.selected')?.textContent.trim() || 'M';

          let existingItem = cartItems.find(item => item.name === name && item.size === size);
          if (existingItem) {
            existingItem.qty += quantity;
          } else {
            cartItems.push({
              id: 'product-' + Date.now(),
              name: name,
              price: price,
              currency: currencySymbol,
              qty: quantity,
              size: size,
              image: image
            });
          }

          saveCartToStorage();
          alert(`‚úÖ Added ${quantity} x "${name}" (Size: ${size}) to cart!`);
        });
      }

      // -----------------------
      // CART UI: render & fade (colors changed to white/gray/black)
      // -----------------------
      const cartIcon = document.getElementById('open-cart-floating');
      const cartOverlay = document.getElementById('cart-overlay');
      const closeCartBtn = document.getElementById('close-cart');
      const cartItemsEl = document.getElementById('cart-items');
      const cartTotalEl = document.getElementById('cart-total');

      function renderCart() {
        if (!cartItemsEl) return;
        if (cartItems.length === 0) {
          cartItemsEl.innerHTML = '<p style="text-align:center; font-size:1.2rem; color:#333;">Your cart is empty.</p>';
          if (cartTotalEl) cartTotalEl.textContent = '';
          // make sure cart buy button hidden if exists
          const cartBuy = document.getElementById('buy-now');
          if (cartBuy && cartOverlay && cartOverlay.contains(cartBuy)) cartBuy.style.display = 'block'; // keep it visible (user requested)
          if (cartCountEl) cartCountEl.textContent = 0;
          return;
        }

        let total = 0;
        cartItemsEl.innerHTML = cartItems.map(item => {
          total += item.price * item.qty;
          return `
      <div class="cart-item" data-id="${item.id}" style="
         display:grid; grid-template-columns:80px 2fr 1fr 1fr auto;
         align-items:center; gap:10px; background:#f8f8f8; padding:15px;
         border-left:5px solid #333; margin-bottom:15px; border-radius:8px;">
         <img src="${item.image}" alt="${item.name}" style="width:70px;height:70px;object-fit:cover;border-radius:6px;border:1px solid #ddd;">
         <div style="color:#333;">
           <strong>${item.name}</strong><br><small style="color:#666">Size: ${item.size}</small>
         </div>
         <div style="color:#333;text-align:center;">Qty: ${item.qty}</div>
         <div style="color:#333;text-align:center;">${item.currency}${(item.price * item.qty).toLocaleString()}</div>
         <button class="remove-item" data-id="${item.id}" style="background:none;border:1px solid #333;color:#333;padding:5px 10px;border-radius:5px;cursor:pointer;">Remove</button>
      </div>
      `;
        }).join('');

        if (cartTotalEl) cartTotalEl.textContent = `Total: ${cartItems[0]?.currency || '‚Ç¶'}${total.toLocaleString()}`;
        if (cartCountEl) cartCountEl.textContent = cartItems.reduce((s, i) => s + i.qty, 0);

        // add remove listeners
        document.querySelectorAll('.remove-item').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const id = e.target.dataset.id;
            cartItems = cartItems.filter(it => it.id !== id);
            saveCartToStorage();
            renderCart();
          });
          btn.addEventListener('mouseover', () => { btn.style.background = '#333'; btn.style.color = '#fff'; });
          btn.addEventListener('mouseout', () => { btn.style.background = 'none'; btn.style.color = '#333'; });
        });

        // hover for cart items
        document.querySelectorAll('.cart-item').forEach(ci => {
          ci.addEventListener('mouseover', () => { ci.style.background = '#e8e8e8'; ci.style.transform = 'scale(1.02)'; });
          ci.addEventListener('mouseout', () => { ci.style.background = '#f8f8f8'; ci.style.transform = 'scale(1)'; });
        });
      }

      // cart fade open/close (preserve)
      if (cartIcon && cartOverlay) {
        cartIcon.addEventListener('click', () => {
          cartOverlay.style.display = 'block';
          cartOverlay.style.opacity = 0;
          let op = 0;
          const fadeIn = setInterval(() => {
            if (op >= 1) { clearInterval(fadeIn); return; }
            op += 0.05;
            cartOverlay.style.opacity = op;
          }, 15);
          renderCart();
        });
      }
      if (closeCartBtn) closeCartBtn.addEventListener('click', () => {
        let op = 1;
        const fadeOut = setInterval(() => {
          if (op <= 0) { clearInterval(fadeOut); cartOverlay.style.display = 'none'; return; }
          op -= 0.05;
          cartOverlay.style.opacity = op;
        }, 15);
      });

      // -----------------------
      // BUY NOW popup + shipping fees + confirm (colors changed to white/gray/black)
      // -----------------------
      // Ensure popupOverlay exists (if your HTML already has #buy-popup we will reuse it; otherwise create)
      let popupOverlay = document.getElementById('buy-popup');
      if (!popupOverlay) {
        popupOverlay = document.createElement('div');
        popupOverlay.id = 'buy-popup';
        popupOverlay.style.position = 'fixed';
        popupOverlay.style.inset = '0';
        popupOverlay.style.display = 'none';
        popupOverlay.style.alignItems = 'center';
        popupOverlay.style.justifyContent = 'center';
        popupOverlay.style.background = 'rgba(255,255,255,0.9)';
        popupOverlay.style.zIndex = '99999';
        document.body.appendChild(popupOverlay);
      }

      // show luxury confirmation (now stays until X clicked)
      function showLuxuryConfirmation(orderSummaryText, maskedPaymentText, expectedDelivery, referenceCode) {
        const conf = document.createElement('div');
        conf.style.position = 'fixed';
        conf.style.top = '50%';
        conf.style.left = '50%';
        conf.style.transform = 'translate(-50%, -50%)';
        conf.style.background = 'rgba(255,255,255,0.98)';
        conf.style.border = '2px solid #333';
        conf.style.color = '#333';
        conf.style.padding = '28px';
        conf.style.borderRadius = '12px';
        conf.style.zIndex = '100000';
        conf.style.textAlign = 'center';
        conf.style.fontFamily = 'Poppins, sans-serif';
        conf.style.boxShadow = '0 12px 30px rgba(0,0,0,0.2)';
        conf.style.opacity = '1';
        conf.style.transition = 'opacity 0.8s ease';
        conf.innerHTML = `
    <div style="font-size:44px; line-height:1;">‚ú®</div>
    <h3 style="margin:10px 0 6px 0;">Congratulations ‚Äî Order Placed</h3>
    <p style="margin:6px 0 12px 0;color:#666;">${orderSummaryText}</p>
    <p style="margin:6px 0 8px 0;font-size:0.95rem;">${maskedPaymentText}</p>
    <p style="margin:6px 0 8px 0;font-size:0.95rem;">Reference: <strong>${referenceCode}</strong></p>
    <p style="margin:6px 0 10px 0;font-size:0.95rem;">Expected delivery: <strong>${expectedDelivery}</strong></p>
    <button id="close-luxury-popup" style="margin-top:12px;padding:10px 16px;border:none;border-radius:6px;background:#333;color:#fff;cursor:pointer;">Close</button>
  `;

        document.body.appendChild(conf);

        // close button
        document.getElementById('close-luxury-popup').addEventListener('click', () => {
          conf.remove();
        });
      }

      // Generate unique reference code
      function generateReferenceCode() {
        return 'REF-' + Date.now().toString(36).toUpperCase().slice(-8);
      }

      function openBuyNow(items, options = { clearCartOnComplete: false }) {
        if (!popupOverlay) return;
        popupOverlay.innerHTML = '';
        popupOverlay.style.display = 'flex';

        const popup = document.createElement('div');
        popup.className = 'popup-content-lux';
        popup.style.width = '420px';
        popup.style.maxHeight = '90vh';
        popup.style.overflowY = 'auto';
        popup.style.background = 'rgba(255,255,255,0.98)';
        popup.style.border = '2px solid #333';
        popup.style.borderRadius = '12px';
        popup.style.padding = '22px';
        popup.style.color = '#333';
        popup.style.position = 'relative';
        popup.style.boxSizing = 'border-box';
        popup.style.fontFamily = 'Poppins, sans-serif';

        popup.innerHTML = `
    <span id="close-popup-x" style="position:absolute;right:14px;top:10px;cursor:pointer;font-size:18px;color:#333;">&times;</span>
    <h2 style="text-align:center;margin:6px 0 14px 0;">Checkout</h2>

    <form id="buy-now-form" style="display:flex;flex-direction:column;gap:10px;">
      <input id="full-name" placeholder="Full Name" style="padding:10px;border-radius:6px;border:1px solid #ddd;background:#fff;color:#333;">
      <input id="address" placeholder="Address" style="padding:10px;border-radius:6px;border:1px solid #ddd;background:#fff;color:#333;">
      <div style="display:flex;gap:8px;">
        <input id="city" placeholder="City" style="flex:1;padding:10px;border-radius:6px;border:1px solid #ddd;background:#fff;color:#333;">
        <input id="phone" placeholder="Phone Number" style="flex:1;padding:10px;border-radius:6px;border:1px solid #ddd;background:#fff;color:#333;">
      </div>

      <label style="margin-top:6px;color:#666;">Shipping Method</label>
      <select id="shipping-method" style="padding:10px;border-radius:6px;border:1px solid #ddd;background:#fff;color:#333;">
        <option value="2000">Standard Shipping (‚Ç¶2,000)</option>
        <option value="5000">Express Shipping (‚Ç¶5,000)</option>
        <option value="8000">Next-Day Shipping (‚Ç¶8,000)</option>
      </select>

      <label style="margin-top:6px;color:#666;">Payment Method</label>
      <select id="payment-method" style="padding:10px;border-radius:6px;border:1px solid #ddd;background:#fff;color:#333;">
        <option value="card">Card</option>
        <option value="bank">Bank Transfer</option>
        <option value="pod">Pay on Delivery</option>
      </select>

      <div id="card-fields" style="display:block;">
        <input id="card-number" placeholder="Card Number (xxxx xxxx xxxx xxxx)" style="padding:10px;border-radius:6px;border:1px solid #ddd;background:#fff;color:#333;">
        <div style="display:flex;gap:8px;">
          <input id="card-expiry" placeholder="MM/YY" style="flex:1;padding:10px;border-radius:6px;border:1px solid #ddd;background:#fff;color:#333;">
          <input id="card-cvv" placeholder="CVV" style="width:120px;padding:10px;border-radius:6px;border:1px solid #ddd;background:#fff;color:#333;">
        </div>
      </div>

      <div id="bank-fields" style="display:none;color:#666;">
        <p style="margin:6px 0;">Transfer to:</p>
        <p style="margin:6px 0;">Account Name: vouxfashionWorldwide</p>
        <p style="margin:6px 0;">Account Number: <strong>0123456789</strong></p>
        <p style="margin:6px 0;">Bank: Zenith Bank</p>
        <p style="margin:6px 0;font-size:0.9rem;">Use reference: <strong id="bank-reference"></strong></p>
      </div>

      <div id="pod-note" style="display:none;color:#666;">
        <p style="margin:6px 0;">Pay when the delivery arrives. A ‚Ç¶1,000 delivery fee may apply on COD.</p>
      </div>

      <div id="order-summary" style="margin-top:6px;color:#333;font-size:0.95rem;"></div>

      <button type="submit" id="confirm-purchase-btn" style="padding:12px;border-radius:8px;border:none;background:#333;color:#fff;font-weight:700;cursor:pointer;">Confirm Purchase</button>
    </form>
  `;

        popupOverlay.appendChild(popup);

        // close logic
        const closeX = document.getElementById('close-popup-x');
        if (closeX) closeX.addEventListener('click', () => { popupOverlay.style.display = 'none'; popup.remove(); });

        // payment method toggle
        const paymentSelect = document.getElementById('payment-method');
        paymentSelect.addEventListener('change', (e) => {
          const val = e.target.value;
          if (val === 'card') {
            document.getElementById('card-fields').style.display = 'block';
            document.getElementById('bank-fields').style.display = 'none';
            document.getElementById('pod-note').style.display = 'none';
          } else if (val === 'bank') {
            document.getElementById('card-fields').style.display = 'none';
            document.getElementById('bank-fields').style.display = 'block';
            document.getElementById('pod-note').style.display = 'none';
          } else {
            document.getElementById('card-fields').style.display = 'none';
            document.getElementById('bank-fields').style.display = 'none';
            document.getElementById('pod-note').style.display = 'block';
          }
          updateOrderSummary();
        });

        // bank ref
        const bankRefEl = document.getElementById('bank-reference');
        bankRefEl.textContent = generateReferenceCode();

        // fill order summary and shipping logic
        const shippingSelect = document.getElementById('shipping-method');
        let shippingFee = parseInt(shippingSelect.value, 10) || 2000;

        function updateOrderSummary() {
          const shippingFeeLocal = parseInt(shippingSelect.value, 10) || 2000;
          shippingFee = shippingFeeLocal;
          let subtotal = 0;
          const currency = items[0]?.currency || '‚Ç¶';
          const lines = items.map(it => {
            subtotal += it.price * it.qty;
            return `<div style="margin-bottom:6px;">${it.name} (Size: ${it.size}) x ${it.qty} ‚Üí ${it.currency}${(it.price * it.qty).toLocaleString()}</div>`;
          }).join('');
          const podExtra = (document.getElementById('payment-method').value === 'pod') ? 1000 : 0;
          const total = subtotal + shippingFee + podExtra;
          document.getElementById('order-summary').innerHTML = `
      ${lines}
      <div style="margin-top:8px;color:#666;">Shipping: ${currency}${shippingFee.toLocaleString()}</div>
      ${podExtra ? `<div style="color:#666;">COD Fee: ${currency}${podExtra.toLocaleString()}</div>` : ''}
      <div style="margin-top:8px;font-weight:700;">Total: ${currency}${total.toLocaleString()}</div>
    `;
        }

        shippingSelect.addEventListener('change', updateOrderSummary);
        updateOrderSummary();

        // submit handling
        const buyNowForm = document.getElementById('buy-now-form');
        buyNowForm.addEventListener('submit', (ev) => {
          ev.preventDefault();
          const fullName = document.getElementById('full-name').value.trim();
          const address = document.getElementById('address').value.trim();
          const city = document.getElementById('city').value.trim();
          const phone = document.getElementById('phone').value.trim();
          const paymentMethod = document.getElementById('payment-method').value;

          if (!fullName || !address || !city || !phone) {
            alert('‚ö†Ô∏è Please fill all shipping fields.');
            return;
          }
          if (paymentMethod === 'card') {
            const card = document.getElementById('card-number').value.trim();
            const exp = document.getElementById('card-expiry').value.trim();
            const cvv = document.getElementById('card-cvv').value.trim();
            if (!card || !exp || !cvv) { alert('‚ö†Ô∏è Please fill card details.'); return; }
          }

          let subtotal = items.reduce((s, it) => s + it.price * it.qty, 0);
          const podExtra = (paymentMethod === 'pod') ? 1000 : 0;
          const finalTotal = subtotal + shippingFee + podExtra;
          const currency = items[0]?.currency || '‚Ç¶';

          let masked = '';
          if (paymentMethod === 'card') {
            const card = document.getElementById('card-number').value.trim();
            masked = 'Card: **** **** **** ' + (card.replace(/\s+/g, '').slice(-4) || 'XXXX');
          } else if (paymentMethod === 'bank') {
            masked = 'Bank transfer to: Account 0123456789 (use ref: ' + bankRefEl.textContent + ')';
          } else {
            masked = 'Pay on Delivery (COD)';
          }

          const orderSummaryText = `Order ${items.length} item(s) ‚Ä¢ Total: ${currency}${finalTotal.toLocaleString()}`;
          const expectedDelivery = (shippingFee >= 8000) ? (new Date(Date.now() + 24 * 3600 * 1000)).toLocaleDateString()
            : (shippingFee >= 5000) ? (new Date(Date.now() + 3 * 24 * 3600 * 1000)).toLocaleDateString()
              : (new Date(Date.now() + 5 * 24 * 3600 * 1000)).toLocaleDateString();

          const referenceCode = generateReferenceCode();

          // save order to localStorage (append)
          const storedOrders = JSON.parse(localStorage.getItem('orders')) || [];
          storedOrders.push({
            referenceCode,
            items,
            shippingFee,
            paymentMethod,
            total: finalTotal,
            date: new Date().toISOString()
          });
          localStorage.setItem('orders', JSON.stringify(storedOrders));

          showLuxuryConfirmation(orderSummaryText, masked, expectedDelivery, referenceCode);

          if (options.clearCartOnComplete) {
            cartItems = [];
            saveCartToStorage();
            renderCart();
          }

          popup.remove();
          popupOverlay.style.display = 'none';
        });
      }

      // Attach Buy Now handlers
      function attachBuyNowHandlers() {
        const allBuyNowBtns = Array.from(document.querySelectorAll('button#buy-now'));
        allBuyNowBtns.forEach(btn => {
          if (btn._buyNowAttached) return;
          btn._buyNowAttached = true;

          btn.addEventListener('click', () => {
            const insideCart = cartOverlay && cartOverlay.contains(btn);
            if (insideCart) {
              if (!cartItems || cartItems.length === 0) {
                alert('üõí Your cart is empty!');
                return;
              }
              openBuyNow([...cartItems], { clearCartOnComplete: true });
              return;
            }

            const name = document.getElementById('dynamic-title')?.textContent.trim() || 'Product';
            const priceText = document.getElementById('dynamic-price')?.textContent.trim() || '‚Ç¶0';
            const currencySymbol = priceText.match(/[^\d,.\s]/)?.[0] || '‚Ç¶';
            const price = parsePriceText(priceText);
            const image = document.querySelector('.main-image img')?.src || 'https://via.placeholder.com/80';
            const qty = parseInt(document.getElementById('quantity-input')?.value) || 1;
            const size = document.querySelector('.size-option.selected')?.textContent.trim() || 'M';

            openBuyNow([{ name, price, currency: currencySymbol, qty, size, image }], { clearCartOnComplete: false });
          });
        });
      }

      attachBuyNowHandlers();

      // Also attach previously used product-only buy button if present (defensive)
      const productBuySingle = document.getElementById('buy-now-product');
      if (productBuySingle && !productBuySingle._buyNowAttached) {
        productBuySingle.addEventListener('click', () => {
          const name = document.getElementById('dynamic-title')?.textContent.trim() || 'Product';
          const priceText = document.getElementById('dynamic-price')?.textContent.trim() || '‚Ç¶0';
          const currencySymbol = priceText.match(/[^\d,.\s]/)?.[0] || '‚Ç¶';
          const price = parsePriceText(priceText);
          const image = document.querySelector('.main-image img')?.src || 'https://via.placeholder.com/80';
          const qty = parseInt(document.getElementById('quantity-input')?.value) || 1;
          const size = document.querySelector('.size-option.selected')?.textContent.trim() || 'M';
          openBuyNow([{ name, price, currency: currencySymbol, qty, size, image }]);
        });
      }

      // Ensure cart is rendered at start
      renderCart();

      // Manual Thumbnail handler because product.js doesn't do it
      setTimeout(() => {
        const thumbs = document.querySelectorAll('.thumbnail');
        const mainImg = document.querySelector('.image-placeholder img');
        if (thumbs.length && mainImg) {
          thumbs.forEach(t => {
            t.addEventListener('click', () => {
              const imgInThumb = t.querySelector('img');
              if (imgInThumb) {
                mainImg.src = imgInThumb.src;
              }
            });
          });
        }
      }, 1500); // Wait for product.js to populate

      // If your page loads buttons later dynamically, you can call attachBuyNowHandlers() again.
      // But this script already binds all existing button#buy-now occurrences.
    })();
  </script>
</body>

</html>